{% extends 'base.html' %}

{% block title %}Sales Order {{ order.so_number }} - WMS{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
<li class="breadcrumb-item"><a href="{% url 'orders:sales_order_list' %}">Sales Orders</a></li>
<li class="breadcrumb-item active">{{ order.so_number }}</li>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <h2><i class="fas fa-shopping-cart"></i> Sales Order {{ order.so_number }}</h2>
        <p class="text-muted">Customer: {{ order.customer_name }} | Created by {{ order.created_by }}</p>
    </div>
    <div class="col-md-4 text-end">
        <a href="{% url 'orders:sales_order_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Back to list
        </a>
        <button class="btn btn-outline-primary" onclick="window.print()">
            <i class="fas fa-print"></i> Print
        </button>
    </div>
</div>

<div class="row g-3 mb-4">
    <div class="col-lg-4">
        <div class="stat-card primary">
            <h6 class="text-muted mb-2">Order Summary</h6>
            <p class="mb-1"><strong>SO Number:</strong> {{ order.so_number }}</p>
            <p class="mb-1"><strong>Status:</strong> {{ order.get_status_display }}</p>
            <p class="mb-1"><strong>Order Date:</strong> {{ order.order_date }}</p>
            <p class="mb-1"><strong>Expected Delivery:</strong> {{ order.expected_delivery_date|default:"-" }}</p>
            <p class="mb-0"><strong>Actual Delivery:</strong> {{ order.actual_delivery_date|default:"-" }}</p>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="stat-card success">
            <h6 class="text-muted mb-2">Customer & Delivery</h6>
            <p class="mb-1"><strong>Customer:</strong> {{ order.customer_name }}</p>
            <p class="mb-1"><strong>Phone:</strong> {{ order.customer_phone }}</p>
            <p class="mb-1"><strong>Email:</strong> {{ order.customer_email|default:"-" }}</p>
            <p class="mb-1"><strong>Warehouse:</strong> {{ order.from_warehouse.name }}</p>
            <p class="mb-0"><strong>Items:</strong> {{ order.get_items_count }}</p>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="stat-card warning">
            <h6 class="text-muted mb-2">Financials & Payment</h6>
            <p class="mb-1"><strong>Subtotal:</strong> ₹{{ order.subtotal|floatformat:2 }}</p>
            <p class="mb-1"><strong>Tax:</strong> ₹{{ order.tax_amount|floatformat:2 }}</p>
            <p class="mb-1"><strong>Delivery Charge:</strong> ₹{{ order.delivery_charge|floatformat:2 }}</p>
            <p class="mb-1"><strong>Discount:</strong> ₹{{ order.discount_amount|floatformat:2 }}</p>
            <p class="mb-1"><strong>Total:</strong> ₹{{ order.total_amount|floatformat:2 }}</p>
            <p class="mb-0"><strong>Payment:</strong> {{ order.get_payment_method_display }} ({{ order.get_payment_status_display }})</p>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-lg-6">
        <div class="data-table">
            <h6><i class="fas fa-map-marker-alt"></i> Delivery Address</h6>
            <p class="mb-0">
                {{ order.delivery_address|linebreaksbr }}<br>
                {{ order.delivery_city }}, {{ order.delivery_state }} - {{ order.delivery_postal_code }}
            </p>
        </div>
    </div>
</div>

<div class="data-table mb-4">
    <h5 class="mb-3"><i class="fas fa-list"></i> Line Items</h5>
    <div class="table-responsive">
        <table class="table table-sm table-hover align-middle">
            <thead>
                <tr>
                    <th>Product</th>
                    <th class="text-end">Quantity</th>
                    <th class="text-end">Unit Price</th>
                    <th class="text-end">Line Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td class="text-end">{{ item.quantity }}</td>
                    <td class="text-end">₹{{ item.unit_price|floatformat:2 }}</td>
                    <td class="text-end">₹{{ item.line_total|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center py-4 text-muted">
                        No items added to this order yet.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if order.notes %}
<div class="row g-3">
    <div class="col-md-6">
        <div class="data-table">
            <h6><i class="fas fa-sticky-note"></i> Notes</h6>
            <p class="mb-0">{{ order.notes|linebreaks }}</p>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

